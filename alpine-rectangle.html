<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Alpine.js Rectangle Editor</title>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }

    .editor {
      position: relative;
      width: 800px;
      height: 500px;
      background-image: url('https://placekitten.com/800/500');
      background-size: cover;
      border: 1px solid #ccc;
      overflow: hidden;
    }

    .rectangle {
      position: absolute;
      border: 2px solid;
      box-sizing: border-box;
      cursor: move;
    }

    .handle {
      width: 10px;
      height: 10px;
      background: #fff;
      border: 1px solid #333;
      position: absolute;
    }

    .top-left     { top: -5px; left: -5px; cursor: nw-resize; }
    .top          { top: -5px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
    .top-right    { top: -5px; right: -5px; cursor: ne-resize; }
    .right        { top: 50%; right: -5px; transform: translateY(-50%); cursor: e-resize; }
    .bottom-right { bottom: -5px; right: -5px; cursor: se-resize; }
    .bottom       { bottom: -5px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
    .bottom-left  { bottom: -5px; left: -5px; cursor: sw-resize; }
    .left         { top: 50%; left: -5px; transform: translateY(-50%); cursor: w-resize; }
  </style>
</head>
<body x-data="editor">
  <h2>üìê ÏÇ¨Í∞ÅÌòï ÎìúÎûòÍ∑∏ & Î¶¨ÏÇ¨Ïù¥Ï¶à ÏóêÎîîÌÑ∞</h2>

  <div class="editor"
       @mousedown="startCreate($event)"
       @mousemove.window="onDrag($event)"
       @mouseup.window="endDrag()"
  >
    <template x-for="rect in rectangles" :key="rect.id">
      <div class="rectangle"
           :style="`left: ${rect.x}px; top: ${rect.y}px; width: ${rect.width}px; height: ${rect.height}px; border-color: ${rect.color}`"
           @mousedown="startMove(rect, $event)"
      >
        <template x-for="dir in directions" :key="dir">
          <div
            class="handle"
            :class="dir"
            @mousedown.stop="startResize(rect, dir, $event)"
          ></div>
        </template>
      </div>
    </template>
  </div>

  <script>
document.addEventListener('alpine:init', () => {
Alpine.data('editor', () => ({
rectangles: [
  { id: 1, x: 100, y: 80, width: 120, height: 80, color: '#f00' },
  { id: 2, x: 300, y: 150, width: 100, height: 120, color: '#00f' }
],
directions: ['top-left', 'top', 'top-right', 'right', 'bottom-right', 'bottom', 'bottom-left', 'left'],
dragging: null,
dragType: null,
dragDirection: null,
creatingRect: false,
newRect: null,
startX: 0,
startY: 0,
startRect: null,

startMove(rect, event) {
  this.dragging = rect;
  this.dragType = 'move';
  this.startX = event.clientX;
  this.startY = event.clientY;
  this.startRect = { ...rect };
},

startResize(rect, direction, event) {
  this.dragging = rect;
  this.dragType = 'resize';
  this.dragDirection = direction;
  this.startX = event.clientX;
  this.startY = event.clientY;
  this.startRect = { ...rect };
},

startCreate(event) {
  if (event.target.classList.contains('editor')) {
    this.creatingRect = true;
    const x = event.offsetX;
    const y = event.offsetY;
    const id = Date.now();
    this.newRect = { id, x, y, width: 0, height: 0, color: '#0f0' };
    this.rectangles.push(this.newRect);
    this.startX = event.clientX;
    this.startY = event.clientY;
    this.startRect = { ...this.newRect };
    this.dragging = this.newRect;
    this.dragType = 'resize';
    this.dragDirection = 'bottom-right';
  }
},

onDrag(event) {
  if (!this.dragging) return;
  const dx = event.clientX - this.startX;
  const dy = event.clientY - this.startY;
  const r = this.dragging;
  const s = this.startRect;

  if (this.dragType === 'resize') {
    let newX = s.x;
    let newY = s.y;
    let newWidth = s.width;
    let newHeight = s.height;

    if (this.dragDirection.includes('left')) {
      newX = s.x + dx;
      newWidth = s.width - dx;
    }
    if (this.dragDirection.includes('right')) {
      newWidth = s.width + dx;
    }
    if (this.dragDirection.includes('top')) {
      newY = s.y + dy;
      newHeight = s.height - dy;
    }
    if (this.dragDirection.includes('bottom')) {
      newHeight = s.height + dy;
    }

    // Î∞òÏ†Ñ Ï≤¥ÌÅ¨ (ÏùåÏàò ÌÅ¨Í∏∞ Î≥¥Ï†ï)
    if (newWidth < 0) {
      newX += newWidth;
      newWidth *= -1;
    }
    if (newHeight < 0) {
      newY += newHeight;
      newHeight *= -1;
    }

    r.x = newX;
    r.y = newY;
    r.width = newWidth;
    r.height = newHeight;
  }

  if (this.dragType === 'move') {
    r.x = s.x + dx;
    r.y = s.y + dy;
  }
},

endDrag() {
  if (this.dragging && (this.dragging.width < 10 || this.dragging.height < 10)) {
    this.rectangles = this.rectangles.filter(r => r.id !== this.dragging.id);
  }
  this.dragging = null;
  this.dragType = null;
  this.dragDirection = null;
  this.creatingRect = false;
  this.newRect = null;
}
}));
});
  </script>
</body>
</html>
